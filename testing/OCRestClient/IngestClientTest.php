<?php
/**
 * @author          Jan-Frederik Leissner <jleissner@uos.de>
 * @copyright   (c) Authors
 * @version         1.0 (13:27)
 */

require_once '../../classes/cURL.php';
require_once '../../classes/mock/MockcURLResponse.php';
require_once '../../classes/mock/MockcURL.php';
require_once '../../classes/OCRestClient/OCRestClient.php';
require_once '../../classes/mock/MockDBManager.php';

require_once '../../models/OCModel.php';
require_once '../../classes/OCRestClient/IngestClient.php';

function studip_utf8encode($data)
{
    if (is_array($data)) {
        $new_data = [];
        foreach ($data as $key => $value) {
            $key = studip_utf8encode($key);
            $new_data[$key] = studip_utf8encode($value);
        }

        return $new_data;
    }

    if (!preg_match('/[\200-\377]/', $data) && !preg_match("'&#[0-9]+;'", $data)) {
        return $data;
    } else {
        return mb_decode_numericentity(
            mb_convert_encoding($data, 'UTF-8', 'WINDOWS-1252'),
            [0x100, 0xffff, 0, 0xffff],
            'UTF-8'
        );
    }
}

use PHPUnit\Framework\TestCase;

/**
 * @runTestsInSeparateProcesses
 * @preserveGlobalState disabled
 */
class IngestClientTest extends TestCase
{

    private $client;
    private $dublincore_basic;
    private $dublincore_schedule;
    private $responses = [];

    protected function setUp()
    {
        class_alias('MockcURL', 'OCcURL');
        class_alias('MockDBManager', 'DBManager');

        //Wird für die Erstellung des Clients benötigt, config wäre sonst fehlerhaft
        MockDBResponse::set_response(new MockDBResponse(
            'SELECT * FROM `oc_endpoints` WHERE service_type = ? AND config_id = ?',
            ['service_url', 'service_host', 'service_type', 'config_id'],
            [
                ['ingest', 'foo.bar/', 'ingest', 1]
            ]
        ));
        MockDBResponse::set_response(new MockDBResponse(
            'SELECT * FROM `oc_config` WHERE config_id = ?',
            ['service_url', 'service_user', 'service_password', 'service_version', 'config_id'],
            [
                ['foo.bar', 'matterhorn', 'OPENCAST', 1]
            ]
        ));

        //Täuscht die cURL Antworten vor
        $this->responses[0] = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><mediapackage xmlns="http://mediapackage.opencastproject.org" id="978935c6-ffa7-4b1b-89fd-263e15f7d8d2" start="2018-10-22T10:21:06Z"><media/><metadata/><attachments/><publications/></mediapackage>';
        MockcURLResponse::set_response(
            new MockcURLResponse(
                '/createMediaPackage',
                200,
                $this->responses[0]
            )
        );
        $this->responses[1] = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><mediapackage xmlns="http://mediapackage.opencastproject.org" id="978935c6-ffa7-4b1b-89fd-263e15f7d8d2" start="2018-10-22T10:21:06Z"><media><track id="e9f865af-6ddd-4032-938f-6cce01cb4a88" type="presenter/source"><tags><tag>tag_1</tag></tags><url>https://vm123.rz.uos.de/files/mediapackage/978935c6-ffa7-4b1b-89fd-263e15f7d8d2/e9f865af-6ddd-4032-938f-6cce01cb4a88/test.mp4</url><live>false</live></track></media><metadata/><attachments/><publications/></mediapackage>';
        MockcURLResponse::set_response(
            new MockcURLResponse(
                '/addTrack',
                200,
                $this->responses[1]
            )
        );
        $this->responses[2] = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><mediapackage xmlns="http://mediapackage.opencastproject.org" id="978935c6-ffa7-4b1b-89fd-263e15f7d8d2" start="2018-10-22T10:21:06Z"><media/><metadata><catalog id="9b1afcc9-3f4e-40c4-b359-fee8b9318b0c" type="dublincore/episode"><mimetype>text/xml</mimetype><tags/><url>https://vm123.rz.uos.de/files/mediapackage/978935c6-ffa7-4b1b-89fd-263e15f7d8d2/9b1afcc9-3f4e-40c4-b359-fee8b9318b0c/dublincore.xml</url></catalog></metadata><attachments/><publications/></mediapackage>';
        MockcURLResponse::set_response(
            new MockcURLResponse(
                '/addDCCatalog',
                200,
                $this->responses[2]
            )
        );
        $this->responses[3] = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><wf:workflow id="19770" state="INSTANTIATED" xmlns:sec="http://org.opencastproject.security" xmlns:mp="http://mediapackage.opencastproject.org" xmlns:wf="http://workflow.opencastproject.org"><wf:template>fast</wf:template><wf:title>Fast Testing Workflow</wf:title><wf:description>
    A minimal workflow that transcodes the media into distribution formats, then
    sends the resulting distribution files, along with their associated metadata,
    to the distribution channels.
  </wf:description><wf:parent xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/><sec:creator><sec:username>admin</sec:username><sec:name>Opencast Project Administrator</sec:name><sec:email>admin@localhost</sec:email><sec:provider>opencast</sec:provider><sec:manageable>true</sec:manageable><sec:roles><sec:role><sec:name>ROLE_OAUTH_USER</sec:name><sec:organization id="mh_default_org"><sec:name>Opencast Project</sec:name><sec:servers><sec:server name="localhost" port="8080"/><sec:server name="http://localhost" port="80"/></sec:servers><sec:adminRole>ROLE_ADMIN</sec:adminRole><sec:anonymousRole>ROLE_ANONYMOUS</sec:anonymousRole><sec:properties><sec:property key="admin.shortcut.general.new_event">n</sec:property><sec:property key="engageui.link_download.enable">false</sec:property><sec:property key="player.shortcut.controls.prevChapter">pagedown</sec:property><sec:property key="admin.shortcut.player.next_segment">down</sec:property><sec:property key="player.shortcut.playbackrate.decrease">T</sec:property><sec:property key="admin.shortcut.player.previous_segment">up</sec:property><sec:property key="admin.shortcut.general.remove_filters">r</sec:property><sec:property key="engageui.link_mobile_redirect.url">http://opencast.org/</sec:property><sec:property key="admin.shortcut.editor.cut_selected_segment">backspace</sec:property><sec:property key="logo_player">/engage/theodul/ui/img/opencast.svg</sec:property><sec:property key="show_embed_links">true</sec:property><sec:property key="adminui.chunksize">2048</sec:property><sec:property key="player.positioncontrols">bottom</sec:property><sec:property key="org.opencastproject.oaipmh.server.hosturl"></sec:property><sec:property key="admin.shortcut.player.play_pause">space</sec:property><sec:property key="player.shortcut.controls.nextChapter">pageup</sec:property><sec:property key="engageui.link_mobile_redirect.enable">false</sec:property><sec:property key="logo_mediamodule">/engage/ui/img/logo/opencast-icon.svg</sec:property><sec:property key="admin.shortcut.general.series_view">s</sec:property><sec:property key="admin.shortcut.player.volume_up">+</sec:property><sec:property key="player.shortcut.volume.up">9</sec:property><sec:property key="player.shortcut.playbackrate.increase">t</sec:property><sec:property key="player.shortcut.zoom.moveLeft">a</sec:property><sec:property key="player.shortcut.zoom.moveUp">w</sec:property><sec:property key="player.shortcut.layout.focusPrev">&lt;</sec:property><sec:property key="player.shortcut.zoom.in">+</sec:property><sec:property key="admin.shortcut.general.select_next_dashboard_filter">f</sec:property><sec:property key="admin.shortcut.general.main_menu">m</sec:property><sec:property key="player.hide_video_context_menu">false</sec:property><sec:property key="player.shortcut.layout.togglePiP">o</sec:property><sec:property key="player.shortcut.fullscreen.cancel">escape</sec:property><sec:property key="admin.shortcut.general.new_series">N</sec:property><sec:property key="login.display_defaults">true</sec:property><sec:property key="admin.shortcut.editor.play_current_segment_with_pre-roll">C</sec:property><sec:property key="player.shortcut.zoom.out">-</sec:property><sec:property key="player.shortcut.volume.muteToggle">m</sec:property><sec:property key="player">/engage/theodul/ui/core.html</sec:property><sec:property key="player.allowedtags">engage-download,engage-streaming</sec:property><sec:property key="admin.shortcut.player.step_backward">ctrl+left</sec:property><sec:property key="player.shortcut.controls.playPause">space</sec:property><sec:property key="player.layout">off</sec:property><sec:property key="admin.shortcut.player.step_forward">ctrl+right</sec:property><sec:property key="link_mediamodule">true</sec:property><sec:property key="player.shortcut.controls.jumpToBegin">backspace</sec:property><sec:property key="admin.shortcut.editor.play_current_segment">c</sec:property><sec:property key="player.shortcut.layout.focusNext">&gt;</sec:property><sec:property key="admin.shortcut.general.select_previous_dashboard_filter">F</sec:property><sec:property key="org.opencastproject.admin.help.restdocs.url">/rest_docs.html</sec:property><sec:property key="admin.shortcut.player.previous_frame">left</sec:property><sec:property key="player.shortcut.zoom.moveDown">s</sec:property><sec:property key="org.opencastproject.admin.mediamodule.url">/engage/ui</sec:property><sec:property key="player.shortcut.controls.seekLeft">left</sec:property><sec:property key="admin.shortcut.editor.split_at_current_time">v</sec:property><sec:property key="admin.shortcut.general.help">?</sec:property><sec:property key="player.mastervideotype">presenter/delivery</sec:property><sec:property key="player.shortcut.zoom.moveRight">d</sec:property><sec:property key="admin.shortcut.general.event_view">e</sec:property><sec:property key="admin.shortcut.player.volume_down">-</sec:property><sec:property key="admin.shortcut.editor.clear_list">ctrl+backspace</sec:property><sec:property key="player.shortcut-sequence">controls,volume,playbackrate,layout,zoom,fullscreen</sec:property><sec:property key="admin.shortcut.editor.play_ending_of_current_segment">n</sec:property><sec:property key="player.shortcut.controls.seekRight">right</sec:property><sec:property key="admin.shortcut.player.mute">m</sec:property><sec:property key="org.opencastproject.admin.help.documentation.url">http://docs.opencast.org</sec:property><sec:property key="player.shortcut.volume.down">8</sec:property><sec:property key="player.shortcut.fullscreen.enable">mod+enter</sec:property><sec:property key="admin.shortcut.player.next_frame">right</sec:property><sec:property key="adminui.user.external_role_display">false</sec:property><sec:property key="player.shortcut.layout.movePiP">p</sec:property><sec:property key="engageui.annotations.enable">true</sec:property><sec:property key="engageui.links_media_module.enable">true</sec:property><sec:property key="player.focusedflavor">presentation</sec:property><sec:property key="engageui.link_mobile_redirect.description">For more information have a look at the official site.</sec:property></sec:properties></sec:organization><sec:type>INTERNAL</sec:type></sec:role><sec:role><sec:name>ROLE_ADMIN</sec:name><sec:organization id="mh_default_org"><sec:name>Opencast Project</sec:name><sec:servers><sec:server name="localhost" port="8080"/><sec:server name="http://localhost" port="80"/></sec:servers><sec:adminRole>ROLE_ADMIN</sec:adminRole><sec:anonymousRole>ROLE_ANONYMOUS</sec:anonymousRole><sec:properties><sec:property key="admin.shortcut.general.new_event">n</sec:property><sec:property key="engageui.link_download.enable">false</sec:property><sec:property key="player.shortcut.controls.prevChapter">pagedown</sec:property><sec:property key="admin.shortcut.player.next_segment">down</sec:property><sec:property key="player.shortcut.playbackrate.decrease">T</sec:property><sec:property key="admin.shortcut.player.previous_segment">up</sec:property><sec:property key="admin.shortcut.general.remove_filters">r</sec:property><sec:property key="engageui.link_mobile_redirect.url">http://opencast.org/</sec:property><sec:property key="admin.shortcut.editor.cut_selected_segment">backspace</sec:property><sec:property key="logo_player">/engage/theodul/ui/img/opencast.svg</sec:property><sec:property key="show_embed_links">true</sec:property><sec:property key="adminui.chunksize">2048</sec:property><sec:property key="player.positioncontrols">bottom</sec:property><sec:property key="org.opencastproject.oaipmh.server.hosturl"></sec:property><sec:property key="admin.shortcut.player.play_pause">space</sec:property><sec:property key="player.shortcut.controls.nextChapter">pageup</sec:property><sec:property key="engageui.link_mobile_redirect.enable">false</sec:property><sec:property key="logo_mediamodule">/engage/ui/img/logo/opencast-icon.svg</sec:property><sec:property key="admin.shortcut.general.series_view">s</sec:property><sec:property key="admin.shortcut.player.volume_up">+</sec:property><sec:property key="player.shortcut.volume.up">9</sec:property><sec:property key="player.shortcut.playbackrate.increase">t</sec:property><sec:property key="player.shortcut.zoom.moveLeft">a</sec:property><sec:property key="player.shortcut.zoom.moveUp">w</sec:property><sec:property key="player.shortcut.layout.focusPrev">&lt;</sec:property><sec:property key="player.shortcut.zoom.in">+</sec:property><sec:property key="admin.shortcut.general.select_next_dashboard_filter">f</sec:property><sec:property key="admin.shortcut.general.main_menu">m</sec:property><sec:property key="player.hide_video_context_menu">false</sec:property><sec:property key="player.shortcut.layout.togglePiP">o</sec:property><sec:property key="player.shortcut.fullscreen.cancel">escape</sec:property><sec:property key="admin.shortcut.general.new_series">N</sec:property><sec:property key="login.display_defaults">true</sec:property><sec:property key="admin.shortcut.editor.play_current_segment_with_pre-roll">C</sec:property><sec:property key="player.shortcut.zoom.out">-</sec:property><sec:property key="player.shortcut.volume.muteToggle">m</sec:property><sec:property key="player">/engage/theodul/ui/core.html</sec:property><sec:property key="player.allowedtags">engage-download,engage-streaming</sec:property><sec:property key="admin.shortcut.player.step_backward">ctrl+left</sec:property><sec:property key="player.shortcut.controls.playPause">space</sec:property><sec:property key="player.layout">off</sec:property><sec:property key="admin.shortcut.player.step_forward">ctrl+right</sec:property><sec:property key="link_mediamodule">true</sec:property><sec:property key="player.shortcut.controls.jumpToBegin">backspace</sec:property><sec:property key="admin.shortcut.editor.play_current_segment">c</sec:property><sec:property key="player.shortcut.layout.focusNext">&gt;</sec:property><sec:property key="admin.shortcut.general.select_previous_dashboard_filter">F</sec:property><sec:property key="org.opencastproject.admin.help.restdocs.url">/rest_docs.html</sec:property><sec:property key="admin.shortcut.player.previous_frame">left</sec:property><sec:property key="player.shortcut.zoom.moveDown">s</sec:property><sec:property key="org.opencastproject.admin.mediamodule.url">/engage/ui</sec:property><sec:property key="player.shortcut.controls.seekLeft">left</sec:property><sec:property key="admin.shortcut.editor.split_at_current_time">v</sec:property><sec:property key="admin.shortcut.general.help">?</sec:property><sec:property key="player.mastervideotype">presenter/delivery</sec:property><sec:property key="player.shortcut.zoom.moveRight">d</sec:property><sec:property key="admin.shortcut.general.event_view">e</sec:property><sec:property key="admin.shortcut.player.volume_down">-</sec:property><sec:property key="admin.shortcut.editor.clear_list">ctrl+backspace</sec:property><sec:property key="player.shortcut-sequence">controls,volume,playbackrate,layout,zoom,fullscreen</sec:property><sec:property key="admin.shortcut.editor.play_ending_of_current_segment">n</sec:property><sec:property key="player.shortcut.controls.seekRight">right</sec:property><sec:property key="admin.shortcut.player.mute">m</sec:property><sec:property key="org.opencastproject.admin.help.documentation.url">http://docs.opencast.org</sec:property><sec:property key="player.shortcut.volume.down">8</sec:property><sec:property key="player.shortcut.fullscreen.enable">mod+enter</sec:property><sec:property key="admin.shortcut.player.next_frame">right</sec:property><sec:property key="adminui.user.external_role_display">false</sec:property><sec:property key="player.shortcut.layout.movePiP">p</sec:property><sec:property key="engageui.annotations.enable">true</sec:property><sec:property key="engageui.links_media_module.enable">true</sec:property><sec:property key="player.focusedflavor">presentation</sec:property><sec:property key="engageui.link_mobile_redirect.description">For more information have a look at the official site.</sec:property></sec:properties></sec:organization><sec:type>INTERNAL</sec:type></sec:role><sec:role><sec:name>ROLE_ANONYMOUS</sec:name><sec:organization id="mh_default_org"><sec:name>Opencast Project</sec:name><sec:servers><sec:server name="localhost" port="8080"/><sec:server name="http://localhost" port="80"/></sec:servers><sec:adminRole>ROLE_ADMIN</sec:adminRole><sec:anonymousRole>ROLE_ANONYMOUS</sec:anonymousRole><sec:properties><sec:property key="admin.shortcut.general.new_event">n</sec:property><sec:property key="engageui.link_download.enable">false</sec:property><sec:property key="player.shortcut.controls.prevChapter">pagedown</sec:property><sec:property key="admin.shortcut.player.next_segment">down</sec:property><sec:property key="player.shortcut.playbackrate.decrease">T</sec:property><sec:property key="admin.shortcut.player.previous_segment">up</sec:property><sec:property key="admin.shortcut.general.remove_filters">r</sec:property><sec:property key="engageui.link_mobile_redirect.url">http://opencast.org/</sec:property><sec:property key="admin.shortcut.editor.cut_selected_segment">backspace</sec:property><sec:property key="logo_player">/engage/theodul/ui/img/opencast.svg</sec:property><sec:property key="show_embed_links">true</sec:property><sec:property key="adminui.chunksize">2048</sec:property><sec:property key="player.positioncontrols">bottom</sec:property><sec:property key="org.opencastproject.oaipmh.server.hosturl"></sec:property><sec:property key="admin.shortcut.player.play_pause">space</sec:property><sec:property key="player.shortcut.controls.nextChapter">pageup</sec:property><sec:property key="engageui.link_mobile_redirect.enable">false</sec:property><sec:property key="logo_mediamodule">/engage/ui/img/logo/opencast-icon.svg</sec:property><sec:property key="admin.shortcut.general.series_view">s</sec:property><sec:property key="admin.shortcut.player.volume_up">+</sec:property><sec:property key="player.shortcut.volume.up">9</sec:property><sec:property key="player.shortcut.playbackrate.increase">t</sec:property><sec:property key="player.shortcut.zoom.moveLeft">a</sec:property><sec:property key="player.shortcut.zoom.moveUp">w</sec:property><sec:property key="player.shortcut.layout.focusPrev">&lt;</sec:property><sec:property key="player.shortcut.zoom.in">+</sec:property><sec:property key="admin.shortcut.general.select_next_dashboard_filter">f</sec:property><sec:property key="admin.shortcut.general.main_menu">m</sec:property><sec:property key="player.hide_video_context_menu">false</sec:property><sec:property key="player.shortcut.layout.togglePiP">o</sec:property><sec:property key="player.shortcut.fullscreen.cancel">escape</sec:property><sec:property key="admin.shortcut.general.new_series">N</sec:property><sec:property key="login.display_defaults">true</sec:property><sec:property key="admin.shortcut.editor.play_current_segment_with_pre-roll">C</sec:property><sec:property key="player.shortcut.zoom.out">-</sec:property><sec:property key="player.shortcut.volume.muteToggle">m</sec:property><sec:property key="player">/engage/theodul/ui/core.html</sec:property><sec:property key="player.allowedtags">engage-download,engage-streaming</sec:property><sec:property key="admin.shortcut.player.step_backward">ctrl+left</sec:property><sec:property key="player.shortcut.controls.playPause">space</sec:property><sec:property key="player.layout">off</sec:property><sec:property key="admin.shortcut.player.step_forward">ctrl+right</sec:property><sec:property key="link_mediamodule">true</sec:property><sec:property key="player.shortcut.controls.jumpToBegin">backspace</sec:property><sec:property key="admin.shortcut.editor.play_current_segment">c</sec:property><sec:property key="player.shortcut.layout.focusNext">&gt;</sec:property><sec:property key="admin.shortcut.general.select_previous_dashboard_filter">F</sec:property><sec:property key="org.opencastproject.admin.help.restdocs.url">/rest_docs.html</sec:property><sec:property key="admin.shortcut.player.previous_frame">left</sec:property><sec:property key="player.shortcut.zoom.moveDown">s</sec:property><sec:property key="org.opencastproject.admin.mediamodule.url">/engage/ui</sec:property><sec:property key="player.shortcut.controls.seekLeft">left</sec:property><sec:property key="admin.shortcut.editor.split_at_current_time">v</sec:property><sec:property key="admin.shortcut.general.help">?</sec:property><sec:property key="player.mastervideotype">presenter/delivery</sec:property><sec:property key="player.shortcut.zoom.moveRight">d</sec:property><sec:property key="admin.shortcut.general.event_view">e</sec:property><sec:property key="admin.shortcut.player.volume_down">-</sec:property><sec:property key="admin.shortcut.editor.clear_list">ctrl+backspace</sec:property><sec:property key="player.shortcut-sequence">controls,volume,playbackrate,layout,zoom,fullscreen</sec:property><sec:property key="admin.shortcut.editor.play_ending_of_current_segment">n</sec:property><sec:property key="player.shortcut.controls.seekRight">right</sec:property><sec:property key="admin.shortcut.player.mute">m</sec:property><sec:property key="org.opencastproject.admin.help.documentation.url">http://docs.opencast.org</sec:property><sec:property key="player.shortcut.volume.down">8</sec:property><sec:property key="player.shortcut.fullscreen.enable">mod+enter</sec:property><sec:property key="admin.shortcut.player.next_frame">right</sec:property><sec:property key="adminui.user.external_role_display">false</sec:property><sec:property key="player.shortcut.layout.movePiP">p</sec:property><sec:property key="engageui.annotations.enable">true</sec:property><sec:property key="engageui.links_media_module.enable">true</sec:property><sec:property key="player.focusedflavor">presentation</sec:property><sec:property key="engageui.link_mobile_redirect.description">For more information have a look at the official site.</sec:property></sec:properties></sec:organization><sec:type>INTERNAL</sec:type></sec:role><sec:role><sec:name>ROLE_USER_ADMIN</sec:name><sec:description>The user id role</sec:description><sec:organization id="mh_default_org"><sec:name>Opencast Project</sec:name><sec:servers><sec:server name="localhost" port="8080"/><sec:server name="http://localhost" port="80"/></sec:servers><sec:adminRole>ROLE_ADMIN</sec:adminRole><sec:anonymousRole>ROLE_ANONYMOUS</sec:anonymousRole><sec:properties><sec:property key="admin.shortcut.general.new_event">n</sec:property><sec:property key="engageui.link_download.enable">false</sec:property><sec:property key="player.shortcut.controls.prevChapter">pagedown</sec:property><sec:property key="admin.shortcut.player.next_segment">down</sec:property><sec:property key="player.shortcut.playbackrate.decrease">T</sec:property><sec:property key="admin.shortcut.player.previous_segment">up</sec:property><sec:property key="admin.shortcut.general.remove_filters">r</sec:property><sec:property key="engageui.link_mobile_redirect.url">http://opencast.org/</sec:property><sec:property key="admin.shortcut.editor.cut_selected_segment">backspace</sec:property><sec:property key="logo_player">/engage/theodul/ui/img/opencast.svg</sec:property><sec:property key="show_embed_links">true</sec:property><sec:property key="adminui.chunksize">2048</sec:property><sec:property key="player.positioncontrols">bottom</sec:property><sec:property key="org.opencastproject.oaipmh.server.hosturl"></sec:property><sec:property key="admin.shortcut.player.play_pause">space</sec:property><sec:property key="player.shortcut.controls.nextChapter">pageup</sec:property><sec:property key="engageui.link_mobile_redirect.enable">false</sec:property><sec:property key="logo_mediamodule">/engage/ui/img/logo/opencast-icon.svg</sec:property><sec:property key="admin.shortcut.general.series_view">s</sec:property><sec:property key="admin.shortcut.player.volume_up">+</sec:property><sec:property key="player.shortcut.volume.up">9</sec:property><sec:property key="player.shortcut.playbackrate.increase">t</sec:property><sec:property key="player.shortcut.zoom.moveLeft">a</sec:property><sec:property key="player.shortcut.zoom.moveUp">w</sec:property><sec:property key="player.shortcut.layout.focusPrev">&lt;</sec:property><sec:property key="player.shortcut.zoom.in">+</sec:property><sec:property key="admin.shortcut.general.select_next_dashboard_filter">f</sec:property><sec:property key="admin.shortcut.general.main_menu">m</sec:property><sec:property key="player.hide_video_context_menu">false</sec:property><sec:property key="player.shortcut.layout.togglePiP">o</sec:property><sec:property key="player.shortcut.fullscreen.cancel">escape</sec:property><sec:property key="admin.shortcut.general.new_series">N</sec:property><sec:property key="login.display_defaults">true</sec:property><sec:property key="admin.shortcut.editor.play_current_segment_with_pre-roll">C</sec:property><sec:property key="player.shortcut.zoom.out">-</sec:property><sec:property key="player.shortcut.volume.muteToggle">m</sec:property><sec:property key="player">/engage/theodul/ui/core.html</sec:property><sec:property key="player.allowedtags">engage-download,engage-streaming</sec:property><sec:property key="admin.shortcut.player.step_backward">ctrl+left</sec:property><sec:property key="player.shortcut.controls.playPause">space</sec:property><sec:property key="player.layout">off</sec:property><sec:property key="admin.shortcut.player.step_forward">ctrl+right</sec:property><sec:property key="link_mediamodule">true</sec:property><sec:property key="player.shortcut.controls.jumpToBegin">backspace</sec:property><sec:property key="admin.shortcut.editor.play_current_segment">c</sec:property><sec:property key="player.shortcut.layout.focusNext">&gt;</sec:property><sec:property key="admin.shortcut.general.select_previous_dashboard_filter">F</sec:property><sec:property key="org.opencastproject.admin.help.restdocs.url">/rest_docs.html</sec:property><sec:property key="admin.shortcut.player.previous_frame">left</sec:property><sec:property key="player.shortcut.zoom.moveDown">s</sec:property><sec:property key="org.opencastproject.admin.mediamodule.url">/engage/ui</sec:property><sec:property key="player.shortcut.controls.seekLeft">left</sec:property><sec:property key="admin.shortcut.editor.split_at_current_time">v</sec:property><sec:property key="admin.shortcut.general.help">?</sec:property><sec:property key="player.mastervideotype">presenter/delivery</sec:property><sec:property key="player.shortcut.zoom.moveRight">d</sec:property><sec:property key="admin.shortcut.general.event_view">e</sec:property><sec:property key="admin.shortcut.player.volume_down">-</sec:property><sec:property key="admin.shortcut.editor.clear_list">ctrl+backspace</sec:property><sec:property key="player.shortcut-sequence">controls,volume,playbackrate,layout,zoom,fullscreen</sec:property><sec:property key="admin.shortcut.editor.play_ending_of_current_segment">n</sec:property><sec:property key="player.shortcut.controls.seekRight">right</sec:property><sec:property key="admin.shortcut.player.mute">m</sec:property><sec:property key="org.opencastproject.admin.help.documentation.url">http://docs.opencast.org</sec:property><sec:property key="player.shortcut.volume.down">8</sec:property><sec:property key="player.shortcut.fullscreen.enable">mod+enter</sec:property><sec:property key="admin.shortcut.player.next_frame">right</sec:property><sec:property key="adminui.user.external_role_display">false</sec:property><sec:property key="player.shortcut.layout.movePiP">p</sec:property><sec:property key="engageui.annotations.enable">true</sec:property><sec:property key="engageui.links_media_module.enable">true</sec:property><sec:property key="player.focusedflavor">presentation</sec:property><sec:property key="engageui.link_mobile_redirect.description">For more information have a look at the official site.</sec:property></sec:properties></sec:organization><sec:type>SYSTEM</sec:type></sec:role><sec:role><sec:name>ROLE_USER</sec:name><sec:description>The authenticated user role</sec:description><sec:organization id="mh_default_org"><sec:name>Opencast Project</sec:name><sec:servers><sec:server name="localhost" port="8080"/><sec:server name="http://localhost" port="80"/></sec:servers><sec:adminRole>ROLE_ADMIN</sec:adminRole><sec:anonymousRole>ROLE_ANONYMOUS</sec:anonymousRole><sec:properties><sec:property key="admin.shortcut.general.new_event">n</sec:property><sec:property key="engageui.link_download.enable">false</sec:property><sec:property key="player.shortcut.controls.prevChapter">pagedown</sec:property><sec:property key="admin.shortcut.player.next_segment">down</sec:property><sec:property key="player.shortcut.playbackrate.decrease">T</sec:property><sec:property key="admin.shortcut.player.previous_segment">up</sec:property><sec:property key="admin.shortcut.general.remove_filters">r</sec:property><sec:property key="engageui.link_mobile_redirect.url">http://opencast.org/</sec:property><sec:property key="admin.shortcut.editor.cut_selected_segment">backspace</sec:property><sec:property key="logo_player">/engage/theodul/ui/img/opencast.svg</sec:property><sec:property key="show_embed_links">true</sec:property><sec:property key="adminui.chunksize">2048</sec:property><sec:property key="player.positioncontrols">bottom</sec:property><sec:property key="org.opencastproject.oaipmh.server.hosturl"></sec:property><sec:property key="admin.shortcut.player.play_pause">space</sec:property><sec:property key="player.shortcut.controls.nextChapter">pageup</sec:property><sec:property key="engageui.link_mobile_redirect.enable">false</sec:property><sec:property key="logo_mediamodule">/engage/ui/img/logo/opencast-icon.svg</sec:property><sec:property key="admin.shortcut.general.series_view">s</sec:property><sec:property key="admin.shortcut.player.volume_up">+</sec:property><sec:property key="player.shortcut.volume.up">9</sec:property><sec:property key="player.shortcut.playbackrate.increase">t</sec:property><sec:property key="player.shortcut.zoom.moveLeft">a</sec:property><sec:property key="player.shortcut.zoom.moveUp">w</sec:property><sec:property key="player.shortcut.layout.focusPrev">&lt;</sec:property><sec:property key="player.shortcut.zoom.in">+</sec:property><sec:property key="admin.shortcut.general.select_next_dashboard_filter">f</sec:property><sec:property key="admin.shortcut.general.main_menu">m</sec:property><sec:property key="player.hide_video_context_menu">false</sec:property><sec:property key="player.shortcut.layout.togglePiP">o</sec:property><sec:property key="player.shortcut.fullscreen.cancel">escape</sec:property><sec:property key="admin.shortcut.general.new_series">N</sec:property><sec:property key="login.display_defaults">true</sec:property><sec:property key="admin.shortcut.editor.play_current_segment_with_pre-roll">C</sec:property><sec:property key="player.shortcut.zoom.out">-</sec:property><sec:property key="player.shortcut.volume.muteToggle">m</sec:property><sec:property key="player">/engage/theodul/ui/core.html</sec:property><sec:property key="player.allowedtags">engage-download,engage-streaming</sec:property><sec:property key="admin.shortcut.player.step_backward">ctrl+left</sec:property><sec:property key="player.shortcut.controls.playPause">space</sec:property><sec:property key="player.layout">off</sec:property><sec:property key="admin.shortcut.player.step_forward">ctrl+right</sec:property><sec:property key="link_mediamodule">true</sec:property><sec:property key="player.shortcut.controls.jumpToBegin">backspace</sec:property><sec:property key="admin.shortcut.editor.play_current_segment">c</sec:property><sec:property key="player.shortcut.layout.focusNext">&gt;</sec:property><sec:property key="admin.shortcut.general.select_previous_dashboard_filter">F</sec:property><sec:property key="org.opencastproject.admin.help.restdocs.url">/rest_docs.html</sec:property><sec:property key="admin.shortcut.player.previous_frame">left</sec:property><sec:property key="player.shortcut.zoom.moveDown">s</sec:property><sec:property key="org.opencastproject.admin.mediamodule.url">/engage/ui</sec:property><sec:property key="player.shortcut.controls.seekLeft">left</sec:property><sec:property key="admin.shortcut.editor.split_at_current_time">v</sec:property><sec:property key="admin.shortcut.general.help">?</sec:property><sec:property key="player.mastervideotype">presenter/delivery</sec:property><sec:property key="player.shortcut.zoom.moveRight">d</sec:property><sec:property key="admin.shortcut.general.event_view">e</sec:property><sec:property key="admin.shortcut.player.volume_down">-</sec:property><sec:property key="admin.shortcut.editor.clear_list">ctrl+backspace</sec:property><sec:property key="player.shortcut-sequence">controls,volume,playbackrate,layout,zoom,fullscreen</sec:property><sec:property key="admin.shortcut.editor.play_ending_of_current_segment">n</sec:property><sec:property key="player.shortcut.controls.seekRight">right</sec:property><sec:property key="admin.shortcut.player.mute">m</sec:property><sec:property key="org.opencastproject.admin.help.documentation.url">http://docs.opencast.org</sec:property><sec:property key="player.shortcut.volume.down">8</sec:property><sec:property key="player.shortcut.fullscreen.enable">mod+enter</sec:property><sec:property key="admin.shortcut.player.next_frame">right</sec:property><sec:property key="adminui.user.external_role_display">false</sec:property><sec:property key="player.shortcut.layout.movePiP">p</sec:property><sec:property key="engageui.annotations.enable">true</sec:property><sec:property key="engageui.links_media_module.enable">true</sec:property><sec:property key="player.focusedflavor">presentation</sec:property><sec:property key="engageui.link_mobile_redirect.description">For more information have a look at the official site.</sec:property></sec:properties></sec:organization><sec:type>SYSTEM</sec:type></sec:role></sec:roles><sec:organization id="mh_default_org"><sec:name>Opencast Project</sec:name><sec:servers><sec:server name="localhost" port="8080"/><sec:server name="http://localhost" port="80"/></sec:servers><sec:adminRole>ROLE_ADMIN</sec:adminRole><sec:anonymousRole>ROLE_ANONYMOUS</sec:anonymousRole><sec:properties><sec:property key="admin.shortcut.general.new_event">n</sec:property><sec:property key="engageui.link_download.enable">false</sec:property><sec:property key="player.shortcut.controls.prevChapter">pagedown</sec:property><sec:property key="admin.shortcut.player.next_segment">down</sec:property><sec:property key="player.shortcut.playbackrate.decrease">T</sec:property><sec:property key="admin.shortcut.player.previous_segment">up</sec:property><sec:property key="admin.shortcut.general.remove_filters">r</sec:property><sec:property key="engageui.link_mobile_redirect.url">http://opencast.org/</sec:property><sec:property key="admin.shortcut.editor.cut_selected_segment">backspace</sec:property><sec:property key="logo_player">/engage/theodul/ui/img/opencast.svg</sec:property><sec:property key="show_embed_links">true</sec:property><sec:property key="adminui.chunksize">2048</sec:property><sec:property key="player.positioncontrols">bottom</sec:property><sec:property key="org.opencastproject.oaipmh.server.hosturl"></sec:property><sec:property key="admin.shortcut.player.play_pause">space</sec:property><sec:property key="player.shortcut.controls.nextChapter">pageup</sec:property><sec:property key="engageui.link_mobile_redirect.enable">false</sec:property><sec:property key="logo_mediamodule">/engage/ui/img/logo/opencast-icon.svg</sec:property><sec:property key="admin.shortcut.general.series_view">s</sec:property><sec:property key="admin.shortcut.player.volume_up">+</sec:property><sec:property key="player.shortcut.volume.up">9</sec:property><sec:property key="player.shortcut.playbackrate.increase">t</sec:property><sec:property key="player.shortcut.zoom.moveLeft">a</sec:property><sec:property key="player.shortcut.zoom.moveUp">w</sec:property><sec:property key="player.shortcut.layout.focusPrev">&lt;</sec:property><sec:property key="player.shortcut.zoom.in">+</sec:property><sec:property key="admin.shortcut.general.select_next_dashboard_filter">f</sec:property><sec:property key="admin.shortcut.general.main_menu">m</sec:property><sec:property key="player.hide_video_context_menu">false</sec:property><sec:property key="player.shortcut.layout.togglePiP">o</sec:property><sec:property key="player.shortcut.fullscreen.cancel">escape</sec:property><sec:property key="admin.shortcut.general.new_series">N</sec:property><sec:property key="login.display_defaults">true</sec:property><sec:property key="admin.shortcut.editor.play_current_segment_with_pre-roll">C</sec:property><sec:property key="player.shortcut.zoom.out">-</sec:property><sec:property key="player.shortcut.volume.muteToggle">m</sec:property><sec:property key="player">/engage/theodul/ui/core.html</sec:property><sec:property key="player.allowedtags">engage-download,engage-streaming</sec:property><sec:property key="admin.shortcut.player.step_backward">ctrl+left</sec:property><sec:property key="player.shortcut.controls.playPause">space</sec:property><sec:property key="player.layout">off</sec:property><sec:property key="admin.shortcut.player.step_forward">ctrl+right</sec:property><sec:property key="link_mediamodule">true</sec:property><sec:property key="player.shortcut.controls.jumpToBegin">backspace</sec:property><sec:property key="admin.shortcut.editor.play_current_segment">c</sec:property><sec:property key="player.shortcut.layout.focusNext">&gt;</sec:property><sec:property key="admin.shortcut.general.select_previous_dashboard_filter">F</sec:property><sec:property key="org.opencastproject.admin.help.restdocs.url">/rest_docs.html</sec:property><sec:property key="admin.shortcut.player.previous_frame">left</sec:property><sec:property key="player.shortcut.zoom.moveDown">s</sec:property><sec:property key="org.opencastproject.admin.mediamodule.url">/engage/ui</sec:property><sec:property key="player.shortcut.controls.seekLeft">left</sec:property><sec:property key="admin.shortcut.editor.split_at_current_time">v</sec:property><sec:property key="admin.shortcut.general.help">?</sec:property><sec:property key="player.mastervideotype">presenter/delivery</sec:property><sec:property key="player.shortcut.zoom.moveRight">d</sec:property><sec:property key="admin.shortcut.general.event_view">e</sec:property><sec:property key="admin.shortcut.player.volume_down">-</sec:property><sec:property key="admin.shortcut.editor.clear_list">ctrl+backspace</sec:property><sec:property key="player.shortcut-sequence">controls,volume,playbackrate,layout,zoom,fullscreen</sec:property><sec:property key="admin.shortcut.editor.play_ending_of_current_segment">n</sec:property><sec:property key="player.shortcut.controls.seekRight">right</sec:property><sec:property key="admin.shortcut.player.mute">m</sec:property><sec:property key="org.opencastproject.admin.help.documentation.url">http://docs.opencast.org</sec:property><sec:property key="player.shortcut.volume.down">8</sec:property><sec:property key="player.shortcut.fullscreen.enable">mod+enter</sec:property><sec:property key="admin.shortcut.player.next_frame">right</sec:property><sec:property key="adminui.user.external_role_display">false</sec:property><sec:property key="player.shortcut.layout.movePiP">p</sec:property><sec:property key="engageui.annotations.enable">true</sec:property><sec:property key="engageui.links_media_module.enable">true</sec:property><sec:property key="player.focusedflavor">presentation</sec:property><sec:property key="engageui.link_mobile_redirect.description">For more information have a look at the official site.</sec:property></sec:properties></sec:organization></sec:creator><sec:organization id="mh_default_org"><sec:name>Opencast Project</sec:name><sec:servers><sec:server name="localhost" port="8080"/><sec:server name="http://localhost" port="80"/></sec:servers><sec:adminRole>ROLE_ADMIN</sec:adminRole><sec:anonymousRole>ROLE_ANONYMOUS</sec:anonymousRole><sec:properties><sec:property key="admin.shortcut.general.new_event">n</sec:property><sec:property key="engageui.link_download.enable">false</sec:property><sec:property key="player.shortcut.controls.prevChapter">pagedown</sec:property><sec:property key="admin.shortcut.player.next_segment">down</sec:property><sec:property key="player.shortcut.playbackrate.decrease">T</sec:property><sec:property key="admin.shortcut.player.previous_segment">up</sec:property><sec:property key="admin.shortcut.general.remove_filters">r</sec:property><sec:property key="engageui.link_mobile_redirect.url">http://opencast.org/</sec:property><sec:property key="admin.shortcut.editor.cut_selected_segment">backspace</sec:property><sec:property key="logo_player">/engage/theodul/ui/img/opencast.svg</sec:property><sec:property key="show_embed_links">true</sec:property><sec:property key="adminui.chunksize">2048</sec:property><sec:property key="player.positioncontrols">bottom</sec:property><sec:property key="org.opencastproject.oaipmh.server.hosturl"></sec:property><sec:property key="admin.shortcut.player.play_pause">space</sec:property><sec:property key="player.shortcut.controls.nextChapter">pageup</sec:property><sec:property key="engageui.link_mobile_redirect.enable">false</sec:property><sec:property key="logo_mediamodule">/engage/ui/img/logo/opencast-icon.svg</sec:property><sec:property key="admin.shortcut.general.series_view">s</sec:property><sec:property key="admin.shortcut.player.volume_up">+</sec:property><sec:property key="player.shortcut.volume.up">9</sec:property><sec:property key="player.shortcut.playbackrate.increase">t</sec:property><sec:property key="player.shortcut.zoom.moveLeft">a</sec:property><sec:property key="player.shortcut.zoom.moveUp">w</sec:property><sec:property key="player.shortcut.layout.focusPrev">&lt;</sec:property><sec:property key="player.shortcut.zoom.in">+</sec:property><sec:property key="admin.shortcut.general.select_next_dashboard_filter">f</sec:property><sec:property key="admin.shortcut.general.main_menu">m</sec:property><sec:property key="player.hide_video_context_menu">false</sec:property><sec:property key="player.shortcut.layout.togglePiP">o</sec:property><sec:property key="player.shortcut.fullscreen.cancel">escape</sec:property><sec:property key="admin.shortcut.general.new_series">N</sec:property><sec:property key="login.display_defaults">true</sec:property><sec:property key="admin.shortcut.editor.play_current_segment_with_pre-roll">C</sec:property><sec:property key="player.shortcut.zoom.out">-</sec:property><sec:property key="player.shortcut.volume.muteToggle">m</sec:property><sec:property key="player">/engage/theodul/ui/core.html</sec:property><sec:property key="player.allowedtags">engage-download,engage-streaming</sec:property><sec:property key="admin.shortcut.player.step_backward">ctrl+left</sec:property><sec:property key="player.shortcut.controls.playPause">space</sec:property><sec:property key="player.layout">off</sec:property><sec:property key="admin.shortcut.player.step_forward">ctrl+right</sec:property><sec:property key="link_mediamodule">true</sec:property><sec:property key="player.shortcut.controls.jumpToBegin">backspace</sec:property><sec:property key="admin.shortcut.editor.play_current_segment">c</sec:property><sec:property key="player.shortcut.layout.focusNext">&gt;</sec:property><sec:property key="admin.shortcut.general.select_previous_dashboard_filter">F</sec:property><sec:property key="org.opencastproject.admin.help.restdocs.url">/rest_docs.html</sec:property><sec:property key="admin.shortcut.player.previous_frame">left</sec:property><sec:property key="player.shortcut.zoom.moveDown">s</sec:property><sec:property key="org.opencastproject.admin.mediamodule.url">/engage/ui</sec:property><sec:property key="player.shortcut.controls.seekLeft">left</sec:property><sec:property key="admin.shortcut.editor.split_at_current_time">v</sec:property><sec:property key="admin.shortcut.general.help">?</sec:property><sec:property key="player.mastervideotype">presenter/delivery</sec:property><sec:property key="player.shortcut.zoom.moveRight">d</sec:property><sec:property key="admin.shortcut.general.event_view">e</sec:property><sec:property key="admin.shortcut.player.volume_down">-</sec:property><sec:property key="admin.shortcut.editor.clear_list">ctrl+backspace</sec:property><sec:property key="player.shortcut-sequence">controls,volume,playbackrate,layout,zoom,fullscreen</sec:property><sec:property key="admin.shortcut.editor.play_ending_of_current_segment">n</sec:property><sec:property key="player.shortcut.controls.seekRight">right</sec:property><sec:property key="admin.shortcut.player.mute">m</sec:property><sec:property key="org.opencastproject.admin.help.documentation.url">http://docs.opencast.org</sec:property><sec:property key="player.shortcut.volume.down">8</sec:property><sec:property key="player.shortcut.fullscreen.enable">mod+enter</sec:property><sec:property key="admin.shortcut.player.next_frame">right</sec:property><sec:property key="adminui.user.external_role_display">false</sec:property><sec:property key="player.shortcut.layout.movePiP">p</sec:property><sec:property key="engageui.annotations.enable">true</sec:property><sec:property key="engageui.links_media_module.enable">true</sec:property><sec:property key="player.focusedflavor">presentation</sec:property><sec:property key="engageui.link_mobile_redirect.description">For more information have a look at the official site.</sec:property></sec:properties></sec:organization><mp:mediapackage id="978935c6-ffa7-4b1b-89fd-263e15f7d8d2" start="2018-10-22T10:21:06Z"><mp:media/><mp:metadata/><mp:attachments><mp:attachment id="security-policy-series" type="security/xacml+series"><mp:mimetype>text/xml</mp:mimetype><mp:tags/><mp:url>https://vm123.rz.uos.de/files/mediapackage/978935c6-ffa7-4b1b-89fd-263e15f7d8d2/security-policy-series/xacml.xml</mp:url><mp:size>0</mp:size></mp:attachment></mp:attachments><mp:publications/></mp:mediapackage><wf:operations><wf:operation id="defaults" state="INSTANTIATED" description="Applying default configuration values" fail-on-error="true" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="publishLive">false</wf:configuration><wf:configuration key="publishToOaiPmh">true</wf:configuration><wf:configuration key="comment">false</wf:configuration><wf:configuration key="publishToMediaModule">true</wf:configuration><wf:configuration key="uploadedSearchPreview">false</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="series" state="INSTANTIATED" description="Applying access control entries from series" fail-on-error="true" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="apply-acl">true</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="tag" state="INSTANTIATED" description="Tagging media package elements for archival" fail-on-error="true" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="source-flavors">*/*</wf:configuration><wf:configuration key="target-tags">+archive</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="tag" state="INSTANTIATED" description="Tagging uploaded assets for distribution" fail-on-error="true" if="${downloadSourceflavorsExist}" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="source-flavors">${download-source-flavors}</wf:configuration><wf:configuration key="target-tags">+engage-download</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="inspect" state="INSTANTIATED" description="Inspecting audio and video streams" fail-on-error="true" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="accept-no-media">false</wf:configuration><wf:configuration key="overwrite">false</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="compose" state="INSTANTIATED" description="Encoding video" fail-on-error="true" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="target-flavor">*/preview</wf:configuration><wf:configuration key="encoding-profile">fast.http</wf:configuration><wf:configuration key="target-tags">engage-download,engage-streaming,rss,atom</wf:configuration><wf:configuration key="source-flavor">*/source</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="comment" state="INSTANTIATED" description="Mark the recording for review / cutting" fail-on-error="true" if="${comment}" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="reason">EVENTS.EVENTS.DETAILS.COMMENTS.REASONS.CUTTING</wf:configuration><wf:configuration key="action">create</wf:configuration><wf:configuration key="description">Recording has not been reviewed / cut yet.</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="image" state="INSTANTIATED" description="Creating Engage search result thumbnails" fail-on-error="true" if="(NOT (${uploadedSearchPreview})) AND (${publishToMediaModule} OR ${publishToOaiPmh})" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="target-flavor">*/search+preview</wf:configuration><wf:configuration key="time">1</wf:configuration><wf:configuration key="encoding-profile">search-cover.http</wf:configuration><wf:configuration key="target-tags">engage-download</wf:configuration><wf:configuration key="source-flavor">*/preview</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="image" state="INSTANTIATED" description="Creating Engage player preview image" fail-on-error="true" if="${publishToMediaModule} OR ${publishToOaiPmh}" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="target-flavor">*/player+preview</wf:configuration><wf:configuration key="time">1</wf:configuration><wf:configuration key="encoding-profile">player-preview.http</wf:configuration><wf:configuration key="target-tags">engage-download</wf:configuration><wf:configuration key="source-flavor">*/preview</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="segment-video" state="INSTANTIATED" description="Detecting slide transitions in presentation track" fail-on-error="false" if="${publishToMediaModule} OR ${publishToOaiPmh}" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="target-tags">engage-download</wf:configuration><wf:configuration key="source-flavor">presentation/preview</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="segmentpreviews" state="INSTANTIATED" description="Creating presentation segments preview image" fail-on-error="false" if="${publishToMediaModule} OR ${publishToOaiPmh}" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="reference-flavor">presentation/preview</wf:configuration><wf:configuration key="reference-tags">engage-download</wf:configuration><wf:configuration key="target-flavor">presentation/segment+preview</wf:configuration><wf:configuration key="encoding-profile">player-slides.http</wf:configuration><wf:configuration key="target-tags">engage-download</wf:configuration><wf:configuration key="source-flavor">presentation/preview</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="timelinepreviews" state="INSTANTIATED" description="Creating timeline preview images" fail-on-error="false" if="${publishToMediaModule} OR ${publishToOaiPmh}" exception-handler-workflow="error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="target-flavor">*/timeline+preview</wf:configuration><wf:configuration key="target-tags">engage-download</wf:configuration><wf:configuration key="image-count">100</wf:configuration><wf:configuration key="source-flavor">*/preview</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="extract-text" state="INSTANTIATED" description="Extracting text from presentation segments" fail-on-error="false" if="${publishToMediaModule} OR ${publishToOaiPmh}" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="target-tags">engage-download</wf:configuration><wf:configuration key="source-flavor">presentation/preview</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="publish-configure" state="INSTANTIATED" description="Publish to preview publication channel" fail-on-error="true" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="check-availability">true</wf:configuration><wf:configuration key="url-pattern">http://localhost:8080/admin-ng/index.html#/events/events/${event_id}/tools/playback</wf:configuration><wf:configuration key="source-flavors">*/preview</wf:configuration><wf:configuration key="channel-id">internal</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="publish-engage" state="INSTANTIATED" description="Publishing to Engage" fail-on-error="true" if="${publishToMediaModule}" exception-handler-workflow="partial-error" max-attempts="2" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="check-availability">true</wf:configuration><wf:configuration key="download-source-flavors">dublincore/*,security/*</wf:configuration><wf:configuration key="download-source-tags">engage-download</wf:configuration><wf:configuration key="streaming-source-tags">engage-streaming</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="publish-oaipmh" state="INSTANTIATED" description="Publish to OAI-PMH Default Repository" fail-on-error="true" if="${publishToOaiPmh}" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="check-availability">true</wf:configuration><wf:configuration key="download-flavors">dublincore/*,security/*</wf:configuration><wf:configuration key="download-tags">engage-download</wf:configuration><wf:configuration key="streaming-tags">engage-streaming</wf:configuration><wf:configuration key="repository">default</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="snapshot" state="INSTANTIATED" description="Archiving" fail-on-error="true" exception-handler-workflow="partial-error" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="source-tags">archive</wf:configuration></wf:configurations><wf:execution-history/></wf:operation><wf:operation id="cleanup" state="INSTANTIATED" description="Cleaning up" fail-on-error="false" max-attempts="1" failed-attempts="0" retry-strategy="none"><wf:configurations><wf:configuration key="delete-external">true</wf:configuration><wf:configuration key="preserve-flavors">security/*</wf:configuration></wf:configurations><wf:execution-history/></wf:operation></wf:operations><wf:configurations><wf:configuration key="workflowDefinitionId">fast</wf:configuration><wf:configuration key="ingest_start_date">20181022T122106Z</wf:configuration></wf:configurations></wf:workflow>';
        MockcURLResponse::set_response(
            new MockcURLResponse(
                '/ingest/*',
                200,
                $this->responses[3]
            )
        );
        MockcURLResponse::set_response(
            new MockcURLResponse(
                '/schedule/*',
                200,
                ''
            )
        );

        $this->dublincore_basic = '<?xml version="1.0" encoding="UTF-8" standalone="no"?>
                            <dublincore xmlns="http://www.opencastproject.org/xsd/1.0/dublincore/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                <dcterms:creator><![CDATA[test_creator]]></dcterms:creator>
                                <dcterms:contributor><![CDATA[test_contributor]]></dcterms:contributor>
                                <dcterms:subject><![CDATA[test_subject]]></dcterms:subject>
                                <dcterms:created xsi:type="dcterms:W3CDTF">' . OCModel::getDCTime(0) . '</dcterms:created>
                                <dcterms:description><![CDATA[test_description]]></dcterms:description>
                                <dcterms:language><![CDATA[test_language]]></dcterms:language>
                                <dcterms:title><![CDATA[test_title]]></dcterms:title>
                                <dcterms:isPartOf><![CDATA[test_series_id]]></dcterms:isPartOf>
                            </dublincore>';
        $this->dublincore_schedule = '<?xml version="1.0" encoding="UTF-8" standalone="no"?>
                            <dublincore xmlns="http://www.opencastproject.org/xsd/1.0/dublincore/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                <dcterms:creator><![CDATA[test_creator]]></dcterms:creator>
                                <dcterms:contributor><![CDATA[test_contributor]]></dcterms:contributor>
                                <dcterms:created xsi:type="dcterms:W3CDTF">' . OCModel::getDCTime(0) . '</dcterms:created>                     
                                <dcterms:temporal xsi:type="dcterms:Period">start=' . OCModel::getDCTime(0) . '; end=' . OCModel::getDCTime(10000) . '; scheme=W3C-DTF;</dcterms:temporal>
                                <dcterms:description><![CDATA[test_description]]></dcterms:description>
                                <dcterms:subject><![CDATA[test_abstract]]></dcterms:subject>
                                <dcterms:language><![CDATA[test_language]]></dcterms:language>
                                <dcterms:spatial>test_capture_agents</dcterms:spatial>
                                <dcterms:title><![CDATA[test_title]]></dcterms:title>
                                <dcterms:isPartOf>test_series_id</dcterms:isPartOf>
                            </dublincore>';


        $this->client = IngestClient::getInstance();
    }

    public function testCreateMediaPackage()
    {
        $this->assertXmlStringEqualsXmlString($this->responses[0], $this->client->createMediaPackage());
    }

    public function testAddTrack()
    {
        $media_package = $this->client->createMediaPackage();
        $this->assertXmlStringEqualsXmlString($this->responses[1], $this->client->addTrack(
            $media_package,
            'https://vm123.rz.uos.de/files/mediapackage/978935c6-ffa7-4b1b-89fd-263e15f7d8d2/3862d47c-cc22-4d88-a91c-2cb62a881e10/test.mp4',
            'presenter/source'
        ));
    }

    public function testAddDCCatalog()
    {
        $media_package = $this->client->createMediaPackage();
        $this->assertXmlStringEqualsXmlString($this->responses[2], $this->client->addDCCatalog(
            $media_package,
            $this->dublincore_basic,
            'dublincore/episode'
        ));
    }

    public function testIngest()
    {
        $media_package = $this->client->createMediaPackage();
        $this->assertXmlStringEqualsXmlString($this->responses[3], $this->client->ingest(
            $media_package,
            'fast'
        ));
    }

    public function testSchedule()
    {
        $this->assertEquals(['', 200], $this->client->schedule('empty_media_package', 'no_caps', 'fast'));
    }
}
